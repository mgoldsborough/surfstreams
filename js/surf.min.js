"use strict";let app=angular.module("surfstreams",["chart.js"]);app.config(function(e){e.resourceUrlWhitelist(["http://api.surfline.com/**","self"])}),app.controller("SurfController",["$scope","$http",function(e,t){e.sites=[{id:4762,name:"Banyans, HI"},{id:13830,name:"Kahalu'u, HI"},{id:4763,name:"Kawaihae, HI"},{id:10823,name:"Pine Trees, HI"},{id:4750,name:"Pipeline, HI"},{id:4193,name:"Morro, Beach, SF"},{id:5065,name:"Pismo Beach, SF"},{id:4127,name:"Ocean Beach, SF"}]}]),app.controller("SiteController",["$scope","$http","$sce",function(e,t,a){console.debug("Instantiating SiteController");let o=!1;e.analysis,e.tide,e.tideData=[[]],e.tideLabels=[],e.surfData=[[],[]],e.surfSeries=["Surf Min","Surf Max"],e.surfLabels=[],e.$on("ss.fetch",function(){if(o)return void console.log("Already initialized");console.dir("Fetching forecast for site ID: "+e.site.id);let s="http://api.surfline.com/v1/forecasts/"+e.site.id+"?resources=wind,surf,analysis,weather,tide,sort,watertemp&days=3&getAllSpots=false&units=e&interpolate=false&showOptimal=false";t.jsonp(s).then(function(t){console.dir("Got forecast"),console.dir(t);let o=t.data;e.analysis=a.trustAsHtml(o.Analysis.short_term_forecast),e.tide=t.data.Tide,angular.forEach(t.data.Tide.dataPoints,function(t,a){let o=moment(t.Localtime).format("ddd, hA");e.tideLabels.push(o),e.tideData[0].push(t.height)}),angular.forEach(o.Surf.dateStamp,function(t,a){angular.forEach(t,function(t,s){let n=moment(t).format("ddd, hA");e.surfLabels.push(n),e.surfData[0].push(o.Surf.surf_min[a][s]),e.surfData[1].push(o.Surf.surf_max[a][s])})})},function(e){console.dir("Error obtaining forecast"),console.dir(e)}),o=!0})}]),app.directive("ssPanel",["$http",function(e){return{restrict:"E",replace:!0,templateUrl:"templates/panel.html",link:function(t,a,o){let s,n="#player-"+t.site.id;a.on("hidden.bs.collapse",function(e){console.log("Removing player "+n),s&&s.destroy()}),a.on("shown.bs.collapse",function(a){a.stopPropagation(),console.dir("show.bs.collapse");let o="http://api.surfline.com/v1/cams/"+t.site.id;console.log(o),e.jsonp(o).then(function(e){console.log("Got response from Cam ID: ",t.site.id),console.dir(e);let a=e.data.streamInfo.stream[0].file;console.log("Player "+n+" playing stream: "+a),s=new Clappr.Player({parentId:n,source:a,autoPlay:!0,width:"100%",height:"100%"})},function(e){console.dir("Error reading Surfline API"),console.dir(e)}),t.$broadcast("ss.fetch")})}}}]);